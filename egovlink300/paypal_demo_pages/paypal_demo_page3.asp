<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- 
  Script info: script: webscr, cmd: _xclick-flow, template: p/xcl/pay/buy-done, date: Nov. 12, 2004 19:43:30 PST; country: US, language: en_US
  web version: 24.0-282 branch: live-240
  content version: 24.0-268 branch: live-240 
-->
<title>PayPal - PayPal Website Payments - Payment Complete</title>
<META http-equiv="DESCRIPTION" content="PayPal lets you send money to anyone with email. PayPal is free for consumers and works seamlessly with your existing credit card and checking account. You can settle debts, borrow cash, divide bills or split expenses with friends all without going to an ATM or looking for your checkbook."><META http-equiv="KEYWORDS" content="Send, money, payments, credit, credit card, instant, money, financial services, mobile, wireless, WAP, cell phones, two-way pagers, Windows CE">

<link rel="stylesheet" type="text/css" href="pp_styles_111402.css">

<style type="text/css">
	
		/* these apply to all cowp styles*/
		body 						{background-color: #FFFFFF; color: #000000;}
		A 							{color: #0033CC;}
		.pptext 						{color: #000000;}
		.ppsmalltext				{color: #000000;}
		
		/* these are styles that always have to override no matter what the body bg color. They deal with
		the modules on the site that have colored backgrounds that we didn't want to remove (e.g. the pie modules) */
		.ppsmalltextblack 			{color: #000000; font-size: 11px; font-family: verdana,arial,helvetica,sans-serif; font-weight: 400;}
		.ppdashheaderblack			{color: #000000; font-size: 11px; font-family: verdana,arial,helvetica,sans-serif; font-weight: 700;}
		.ppsmalltextbluelink		{color: #0033CC; font-size: 11px; font-family: verdana,arial,helvetica,sans-serif; font-weight: 400; text-decoration: underline;}
		.ppwaxloginbg				{background-color: #FFFFFF;}
	    	.ppwaxloginborder			{background-color: #000000;}	
		.ppmessage					{color: #000000; font-size: 13px; font-family: verdana,arial,helvetica,sans-serif; font-weight: 700;}  
		
		/* these overrides apply to all non-white bg cowp styles */
			
</style>
<link rel="stylesheet" type="text/css" href="pp_table_styles.css">

<script>
	function demo_notice(){
	alert("Hyperlinks and button clicks - with the exception of\nthe CONTINUE button - that take you outside the\npayment process have been disabled for the demo.\nPlease press the CONTINUE button on the bottom\nof the page to move forward thru the demo.");
}
</script>

</head>
<body  >

		

	<table class="ppwaxtablewidth" cellpadding="0" cellspacing="0" border="0" align=center>
		<tr>
			<td colspan=2><img src="/en_US/i/scr/pixel.gif" width=1 height=5></td>
		</tr>
		<tr valign=top>
			<td align=left width=18%>
				<table width=100% cellpadding=0 cellspacing=0 border=0>
					<tr>
						<td><img src="images/logo-xclickBox.gif" border="0" align=bottom></td>
					</tr>
				</table>
			</td>
			<td width="100%" align="center" class="pptext"></td>
		</tr>
		<tr>
			<td colspan=2><img src="images/pixel.gif" width=1 height=5></td>
		</tr>
	</table>


<table class=pscowpimage cellspacing="0" border="0" align=center
			cellpadding="2" bgcolor=FFFFFF	>

			<tr>
			<td>
				<table class=pscowpimage cellpadding=0 cellspacing=0 border=0 align=left bgcolor=FFFFFF>
					<tr><td>** DEMONSTRATION ONLY - NO PAYMENT INFORMATION PROCESSED ** </td></tr>
				</table>
			</td>	
		</tr>
	</table>

<br class="h5">
<table bgcolor="#336699" width="100%" cellspacing="0" cellpadding="0" border="0" align="center">
<tr>
	<td  width="100%"><img src="images/pixel.gif" width=1 height="27" border="0"></td>
</tr>
</table><br class="h5">

<img src="images/pixel.gif" width=1 height=10><br>
					        




<!-- added for 4419 -->
<!-- -->


		       <table class="main" cellpadding="0" cellspacing="0" border="0" align="center">
	<tr>
	  	<td width="100%" class="ppheading">You Made A Payment</td>
	  	  	<td nowrap class="ppsmalltext">Secure Transaction&nbsp;</td>
	  	<td><img src="images/secure_lock_2.gif" border="0"></td>
	  	</tr>
	<tr>
		<td colspan="3"><img src="images/pixel.gif" width="2" height="2"></td>
	</tr>
</table>
<table class="main" cellpadding="0" cellspacing="0" border="0" align="center">
	<tr>
		<td><img src="images/pixel.gif" width=6 height=6></td>
	</tr>
	<tr>
		<td bgcolor=#000000 width=100%><img src="images/pixel.gif" width=1 height=2></td>
	</tr>
	<tr>
		<td><img src="images/pixel.gif" width=6 height=6></td>
	</tr>
</table>
<table class="main" cellpadding="0" cellspacing="0" align="center" border="0"><tr><td>
	
		
						<table width="100%" cellpadding="0" cellspacing="0" border="0" class="pptablesubheading">
	<tr>
		<td><img src="images/pixel.gif" width="6" height="6"></td>
	</tr>
	<tr valign=bottom>
		<td nowrap class="ppsubheading">Payment Information</td>
	</tr>
	<tr>
		<td><img src="images/pixel.gif" width="6" height="6"></td>
	</tr>
</table>	<!-- added for 4422 push 22.0 ---->

<!-- end 4422/22.0 -->		
		    			<span class="pptext">You have sent a secure payment of $<%=request("amount")%> USD for the items below.This credit card transaction will appear on your bill as "PAYPAL *CITYSELDEN".	
			
		You will receive an email receipt for this transaction shortly.<br><BR></span>
	
	</td></tr></table>

			<table class="main" cellspacing="0" cellpadding="0" align="center" border="0"><tr><td>
		<table width=100% cellpadding=0 cellspacing=0 border=0 align=center>
	<tr>
	<td width="150"><img src="images/pixel.gif" width="150" height="1"></td>
	<td width="6"><img src="images/pixel.gif" width="6" height="1"></td>
	<td width="100%"><img src="images/pixel.gif" width="432" height="1"></td>
</tr>
	
	
	<tr valign=top>
		<td align="right" class="pplabel">Amount:</td>
		<td><br class="text_spacer"></td>
		<td class="pptext"> $<%=request("paymentamount")%> USD</td>
	</tr>
	
		
	
		
	
			<tr valign=top>
			<td align="right" class="pplabel">Item Number:</td>
			<td><br class="text_spacer"></td>
			<td class="pptext"><%=request("item_number")%></td>
		</tr>
		
		
			<tr valign=top>
			<td align="right" class="pplabel">Item Title:</td>
			<td><br class="text_spacer"></td>
			<td class="pptext"><%=request("item_name")%>		<br>
	<span class="ppsmalltext">
		<%
			' GET CUSTOM PAYMENT FORM FIELDS
			For each oField in Request.Querystring
				If UCASE(left(oField,7)) = "CUSTOM_" Then
					response.write  UCASE(replace(oField,"custom_","")) & ": " & request(oField) & "<br>"
				End If 
			Next 
		%>
		</span>
</td>
		</tr>
		
	     		<tr valign=top>
			<td align="right" class="pplabel">Quantity:</td>
			<td><br class="text_spacer"></td>
			<td class="pptext">1</td>
		</tr>
     	
			<tr valign=top>
			<td align="right" class="pplabel">Total Amount:</td>
			<td><br class="text_spacer"></td>
			<td class="pptext">$<%=request("custom_paymentamount")%> USD</td>
		</tr>
	
		
</table>
		</td></tr></table>
		

<table class="main" cellpadding="0" cellspacing="0" align="center" border="0"><tr><td>
	
			<table width="100%" cellpadding="0" cellspacing="0" border="0" class="pptablesubheading">
	<tr>
		<td><img src="images/pixel.gif" width="6" height="6"></td>
	</tr>
	<tr valign=bottom>
		<td nowrap class="ppsubheading">Contact Information</td>
	</tr>
	<tr>
		<td><img src="images/pixel.gif" width="6" height="6"></td>
	</tr>
</table>	<table width=100% cellpadding=0 cellspacing=0 border=0>
	<tr>
	<td width="150"><img src="images/pixel.gif" width="150" height="1"></td>
	<td width="6"><img src="images/pixel.gif" width="6" height="1"></td>
	<td width="100%"><img src="images/pixel.gif" width="432" height="1"></td>
</tr>
		<tr valign=top>
		<td align="right" class="pplabel">Business Name:</td>
		<td><br class="text_spacer"></td>
		<td class="pptext">City of Selden</td>
	</tr>
		
			<tr valign=top>
		<td align="right" class="pplabel">Contact Email:</td>
		<td><br class="text_spacer"></td>
		<td class="pptext">jstullenberger@eclink.com</td>
	</tr>
				
		<tr valign=top>
		<td align="right" class="pplabel">Contact Phone:</td>
		<td><br class="text_spacer"></td>
		<td class="pptext">513-683-0150</td>
	</tr>
				
</table>
	



<!-- new page style handling section -- for use when this page is being used as a preview of page style from the button factory or the page style profile section or the admin tool -- ie NOT as a "real" buy-done page; content please review and clean this up -->
			
	
		<table class="main" cellpadding="0" cellspacing="0" border="0" align="center">
	<tr>
		<td><img src="images/pixel.gif" width=6 height=6></td>
	</tr>
	<tr>
		<td bgcolor=#000000 width=100%><img src="images/pixel.gif" width=1 height=2></td>
	</tr>
	<tr>
		<td><img src="images/pixel.gif" width=6 height=6></td>
	</tr>
</table><table class="main" cellpadding="0" cellspacing="0" border="0" align="center">
	<tr>
		<td colspan="3"><img src="images/pixel.gif" width="4" height="4"></td>
	</tr>
	<tr>
		<td width="6"><img src="images/pixel.gif" width="6" height="6"></td>
		<td width="100%" class="ppsmalltext">&nbsp;</TD>
		<td width="6"><img src="images/pixel.gif" width="6" height="6"></td>
	</tr>
	<tr>
		<td colspan="3"><img src="images/pixel.gif" width="6" height="6"></td>
	</tr>
</table>		<table class="main" cellpadding=0 cellspacing=0 border=0 align=center>
			<tr>
				<td class="pptext" width=100% align=right><img src="../images/flashing_foward.gif" align=right></td>
				<td align=right><input type=button onClick="location.href='http://www.egovlink.com/eclink/';" value="Click here to Continue"></td>
			</tr>
		</table>
	
	
  
</td></tr></table> <br><br>
	<table class="main" cellpadding=0 cellspacing=0 border=0 align=center>
		<tr>
			<td align=center valign=top class="ppsmallnote">
				<style type="text/css">
					.links { 
							color: #999999;
							text-decoration: none;
					}
				</style>
				&nbsp;
				PayPal protects your privacy and security.<br> For more information, see our <a href="#" onClick="demo_notice();" >Privacy Policy</a> and <a href="#" onClick="demo_notice();" >User Agreement</a>.<br>
				<br>&nbsp;</td>
		</tr>
	</table>
<br />
</body>
</html></body>
</html>

<%
' CREATE RANDOM TRANSACTION NUMBER 
Randomize()
intRandomInteger = clng((999999 - 1 + 1) * Rnd + 1)
response.write "demotxn" & intRandomInteger


' CREATE DEMO PAYMENT INFORMATION
UpdateDatabase("demotxn" & intRandomInteger)




'----------------------------------------------------------------------------------------
' USER DEFINED FUNCTIONS
'----------------------------------------------------------------------------------------
Function UpdateDatabase(iPaymentRefID)
	
	blnAddNew = False

	' INSERT FORM INFORMATION INTO DATABASE	
	Set oPayment = Server.CreateObject("ADODB.Recordset")
	oPayment.CursorLocation = 3
	sSQL = "SELECT * FROM egov_payments WHERE paymentrefid='" & iPaymentRefID & "'"
	oPayment.Open sSQL, Application("DSN") , 1, 3
	
	' CHECK FOR NEW RECORD
	If oPayment.EOF Then
		' ADD NEW RECORD
		oPayment.AddNew
		oPayment("paymentrefid") = iPaymentRefID
	

		ipaymentserviceid = request("item_number")
	
		oPayment("paymentserviceid") = ipaymentserviceid
		oPayment("userid") = 10
		oPayment("orgid") = 5
		blnAddNew = True
	End If

	' UPDATE PAYMENT DATABASE FIELDS
	oPayment("paymentamount") = Request("custom_paymentamount")
	oPayment("paymentstatus") = "COMPLETED"
	oPayment.Update
	iPaymentID = oPayment("paymentid") '***
	oPayment("paymentinfoid") = AddPaymentInformation(iPaymentID)
	oPayment.Update
	oPayment.Close

	' ADD PAYMENT DETAILS FOR NEW RECORDS
	If blnAddNew Then
		AddPaymentDetail(iPaymentID)
	End If

	'**Add new function here to send email
	SendPaymentEmail(iPaymentID)


	Set oPayment = Nothing

End Function


Function AddPaymentDetail(iPaymentID)


	sDetails = ""
	For Each oField IN Request.Querystring
		sDetails = sDetails & oField & " : " & request(oField) & "</br>"
	Next 

	Set oDetails = Server.CreateObject("ADODB.Recordset")
	oDetails.CursorLocation = 3
	oDetails.Open "egov_paymentdetails", Application("DSN") , 1, 2, 2
	oDetails.AddNew
	oDetails("paymentid") = iPaymentID
	oDetails("paymentsummary") = dbsafe(sDetails)
	oDetails.Update
	oDetails.Close

End Function


Function DBsafe( strDB )
  If Not VarType( strDB ) = vbString Then DBsafe = strDB : Exit Function
  DBsafe = Replace( strDB, "'", "''" )
End Function


Function SendPaymentEmail(iPaymentID)
'They want service address, account number and/or name on account
 
' SEND EMAIL TO LOVELAND
	Set oCustomFields = Server.CreateObject("ADODB.Recordset")
	oCustomFields.CursorLocation = 3
	cSQL = "Select * FROM egov_payment_list WHERE paymentid=" & iPaymentID
	oCustomFields.Open cSQL, Application("DSN") , 1, 3
	
	sMsg = sMsg & "This automated message was sent by the City of Loveland E-Gov web site. Do not reply to this message." & vbcrlf 
	sMsg = sMsg & " " & vbcrlf 
	sMsg = sMsg & "City of Selden E-Gov Website - PAYMENT was submitted on " & Date() & "." & vbcrlf 
	sMsg = sMsg & " " & vbcrlf  
	sMsg = sMsg & "---------------------------------------------------------------------------------------------------" & vbcrlf 
	sMsg = sMsg & " " & vbcrlf 
	sMsg = sMsg & "A payment was made for " & oCustomFields("paymentservicename")  
	sMsg = sMsg & " in the amount of  " & Request("amount")   & "." & vbcrlf & vbcrlf
	sMsg = sMsg & "Payment Details: " & vbcrlf
	sMsg = sMsg & " " & vbcrlf  
	sMsg = sMsg & "---------------------------------------------------------------------------------------------------" & vbcrlf 
	sMsg = sMsg & " " & vbcrlf 
	
	' REFORMAT HTML LINE BREAKS TO ASCII FORMAT
	customPaymentInfo = oCustomFields("payment_information")
	customPaymentInfo = Replace(customPaymentInfo,"custom_","")
	customPaymentInfo = Replace(customPaymentInfo,"</br>",vbcrlf)
	
	
	sMsg = sMsg & customPaymentInfo   & vbcrlf


' CREATE MAIL OBJECT
Set objMail = Server.CreateObject("ecMail.SMTP")
objMail.Host       = "smtp1.eclink.com"
objMail.From       = "jstullenberger@eclink.com"
objMail.FromName   = "City of Loveland E-Gov Payment"
'objMail.sendto     = "ddugan@lovelandoh.com"
objMail.sendto     = "jstullenberger@eclink.com"
objMail.Subject    = "City of Selden E-Gov - PAYMENT Details"
objMail.BodyFormat = 1
objMail.Body       = sMsg 
objMail.Priority   = 1 'PRIORITY_HIGH
ErrorCode = objMail.Send

If ErrorCode <> 0 Then
	'response.write "There was an error sending the email.<br>"
	'response.write ErrorCode & "<br>"
	'response.write Err.Number  & "<br>"
	'response.write Err.Description  & "<br>"
End If
End Function



'------------------------------------------------------------------------------------------------------------
' FUNCTION ADDPAYMENTINFORMATION(IPAYMENTID)
'------------------------------------------------------------------------------------------------------------
Function AddPaymentInformation(iPaymentID)
	
	iReturnValue = 0

	' GET VALUES FROM QUERYSTRING
	sDetails = ""
	For Each oField IN Request.Querystring
		If Left(oField,7) = "custom_" Then
			sDetails = sDetails & oField & " : " & request(oField) & "</br>"
		End If
	Next 

	' ADD VALUES TO DATABASE AND KEY OFF OF THE PAYMENTID
	Set oDetails = Server.CreateObject("ADODB.Recordset")
	oDetails.CursorLocation = 3
	oDetails.Open "egov_paymentinformation", Application("DSN") , 1, 2, 2
	oDetails.AddNew
	oDetails("payment_information") = dbsafe(sDetails)
	oDetails.Update
	iReturnValue = oDetails("paymentinfoid")
	oDetails.Close

	AddPaymentInformation = iReturnValue

End Function
%>